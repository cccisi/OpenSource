#include <string.h>
#include <math.h>
#include <stdio.h>
#include <stdint.h>
#include "poly.h"
#include "polyvec.h"
#include "ntt.h"
#include "params.h"

static uint16_t se[KYBER_N] = {
        3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5,3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5,
        3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5,3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5,
        3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5,3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5,
        3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5,3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5
        };

static uint16_t a1[KYBER_N] = {
        3, 1, 4, 1, 4, 6292, 2, 6289, 4, 3, 4, 6291, 6292, 6290, 6292, 3, 2, 3, 6291, 4, 6289, 2,
        6289, 4, 3, 3, 6291, 3, 2, 6290, 6292, 4, 3, 1, 4, 1, 4, 6292, 2, 6289, 4, 3, 4, 6291,
        6292, 6290, 6292, 3, 2, 3, 6291, 4, 6289, 2, 6289, 4, 3, 3, 6291, 3, 2, 6290, 6292, 4, 3, 1,
        4, 1, 4, 6292, 2, 6289, 4, 3, 4, 6291, 6292, 6290, 6292, 3, 2, 3, 6291, 4, 6289, 2, 6289, 4,
        3, 3, 6291, 3, 2, 6290, 6292, 4, 3, 1, 4, 1, 4, 6292, 2, 6289, 4, 3, 4, 6291, 6292, 6290,
        6292, 3, 2, 3, 6291, 4, 6289, 2, 6289, 4, 3, 3, 6291, 3, 2, 6290, 6292, 4, 3, 1, 4, 1,
        4, 6292, 2, 6289, 4, 3, 4, 6291, 6292, 6290, 6292, 3, 2, 3, 6291, 4, 6289, 2, 6289, 4, 3, 3,
        6291, 3, 2, 6290, 6292, 4, 3, 1, 4, 1, 4, 6292, 2, 6289, 4, 3, 4, 6291, 6292, 6290, 6292, 3,
        2, 3, 6291, 4, 6289, 2, 6289, 4, 3, 3, 6291, 3, 2, 6290, 6292, 4, 3, 1, 4, 1, 4, 6292,
        2, 6289, 4, 3, 4, 6291, 6292, 6290, 6292, 3, 2, 3, 6291, 4, 6289, 2, 6289, 4, 3, 3, 6291, 3,
        2, 6290, 6292, 4, 3, 1, 4, 1, 4, 6292, 2, 6289, 4, 3, 4, 6291, 6292, 6290, 6292, 3, 2, 3,
        6291, 4, 6289, 2, 6289, 4, 3, 3, 6291, 3, 2, 6290, 6292, 0};
static uint16_t a2[KYBER_N] = {
        3, 1, 4, 1, 965, 2240, 2, 7661, 965, 3, 965, 4047, 2240, 5854, 2240, 3, 2, 3, 4047, 4, 7661, 2,
        7661, 4, 3, 3, 4047, 3, 2, 5854, 2240, 965, 3, 1, 4, 1, 965, 2240, 2, 7661, 965, 3, 965, 4047,
        2240, 5854, 2240, 3, 2, 3, 4047, 4, 7661, 2, 7661, 4, 3, 3, 4047, 3, 2, 5854, 2240, 965, 3, 1,
        4, 1, 965, 2240, 2, 7661, 965, 3, 965, 4047, 2240, 5854, 2240, 3, 2, 3, 4047, 4, 7661, 2, 7661, 4,
        3, 3, 4047, 3, 2, 5854, 2240, 965, 3, 1, 4, 1, 965, 2240, 2, 7661, 965, 3, 965, 4047, 2240, 5854,
        2240, 3, 2, 3, 4047, 4, 7661, 2, 7661, 4, 3, 3, 4047, 3, 2, 5854, 2240, 965, 3, 1, 4, 1,
        965, 2240, 2, 7661, 965, 3, 965, 4047, 2240, 5854, 2240, 3, 2, 3, 4047, 4, 7661, 2, 7661, 4, 3, 3,
        4047, 3, 2, 5854, 2240, 965, 3, 1, 4, 1, 965, 2240, 2, 7661, 965, 3, 965, 4047, 2240, 5854, 2240, 3,
        2, 3, 4047, 4, 7661, 2, 7661, 4, 3, 3, 4047, 3, 2, 5854, 2240, 965, 3, 1, 4, 1, 965, 2240,
        2, 7661, 965, 3, 965, 4047, 2240, 5854, 2240, 3, 2, 3, 4047, 4, 7661, 2, 7661, 4, 3, 3, 4047, 3,
        2, 5854, 2240, 965, 3, 1, 4, 1, 965, 2240, 2, 7661, 965, 3, 965, 4047, 2240, 5854, 2240, 3, 2, 3,
        4047, 4, 7661, 2, 7661, 4, 3, 3, 4047, 3, 2, 5854, 2240, 0};



/*************************************************
* Name:        indcpa_keypair
*
* Description: Generates public and private key for the CPA-secure
*              public-key encryption scheme underlying Kyber
*
* Arguments:   - unsigned char *pk: pointer to output public key
*              - unsigned char *sk: pointer to output private key
**************************************************/
int main(void)
{
    int i,j;
    polyvec a[KYBER_K], e, pkpv, skpv;

    for(i=0;i<KYBER_N;i++) {
    a[0].vec->coeffs[i] = a1[i];
    (a[0].vec + 1)->coeffs[i] = a2[i];
    a[1].vec->coeffs[i] = a1[i];
    (a[1].vec + 1)->coeffs[i] = a2[i];
    skpv.vec->coeffs[i] = se[i];
    (skpv.vec + 1)->coeffs[i] = se[i];
    e.vec->coeffs[i] = se[i];
    (e.vec + 1)->coeffs[i] = se[i];
  }

  polyvec_ntt(&skpv);
  for(i=0; i<KYBER_N; i++)       // 利用for循环对int数组中的数字进行逐个输出
      skpv.vec->coeffs[i] = skpv.vec->coeffs[i] % 7681;

  printf("%s", "\n after NTT\n");
  for(i=0; i<KYBER_N; i++)       // 利用for循环对int数组中的数字进行逐个输出
      printf("%d ", skpv.vec->coeffs[i]);

  // matrix-vector multiplication
  for(i=0;i<KYBER_K;i++)
    polyvec_pointwise_acc(&pkpv.vec[i],&skpv,a+i);
  printf("%s", "\n after muladd\n");
  for(i=0; i<KYBER_N; i++)       // 利用for循环对int数组中的数字进行逐个输出
      printf("%d ", pkpv.vec->coeffs[i]);

  polyvec_invntt(&pkpv);
  polyvec_add(&pkpv,&pkpv,&e);
  printf("%s", "\n after INTT\n");
  for(i=0; i<KYBER_N; i++)       // 利用for循环对int数组中的数字进行逐个输出
      printf("%d ", pkpv.vec->coeffs[i]);

}



